<!doctype html>
<html lang="pt-br">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" sizes="64x64" href="/static/favicon.png" />
  <link rel="stylesheet" href="/static/styles.css" />
  <title>ANEXO II • Relatório</title>
</head>

<body>
  <div class="container">

    <div class="topbar centered">
      <div class="brand" style="align-items: center;">
        <img src="/static/brasao.png" alt="Brasão UFPB" class="brand-logo">
        <div style="display:flex; align-items:center; gap:10px;">
          <div>
            <h1>ANEXO II • Relatório de Viagem</h1>
            <p>Preenchimento guiado, validação automática e geração DOCX/PDF</p>
          </div>
          <img src="/static/cchsa.png" alt="CCHSA" class="brand-logo" style="object-fit:contain;">
        </div>
      </div>
      <div class="actions" style="justify-content:center; width:100%;">
        <a class="btn btn-ghost" href="/">Início</a>
        <button type="button" class="btn btn-ghost" data-theme-toggle aria-pressed="false">Modo claro</button>
        <div class="font-controls" aria-label="Ajuste de fonte">
          <button type="button" class="btn btn-ghost btn-compact" data-font-dec aria-label="Diminuir fonte">A-</button>
          <span class="pill font-pill" data-font-display>100%</span>
          <button type="button" class="btn btn-ghost btn-compact" data-font-inc aria-label="Aumentar fonte">A+</button>
        </div>
        <span id="statusBadge" class="badge">Rascunho</span>

      </div>
    </div>

    <div class="card-assistent">
      <div class="card" style="margin:0; text-align:center;">
        <div class="row" style="margin-top:4px; justify-content:center;">
          <button type="button" class="btn btn-accent" id="btnChatFull2">
            <svg class="icon-robot" aria-hidden="true" viewBox="0 0 24 24">
              <path fill="currentColor"
                d="M11 2h2v3h3v2H8V5h3V2Zm-5 7h12a2 2 0 0 1 2 2v6h-2v3H6v-3H4v-6a2 2 0 0 1 2-2Zm0 2v4h12v-4H6Zm4 6a1.5 1.5 0 1 0 0 3h4a1.5 1.5 0 1 0 0-3h-4Zm-2-6.5a1 1 0 1 0 0 2 1 1 0 0 0 0-2Zm8 0a1 1 0 1 0 0 2Z" />
            </svg>
            <span>Assistente (conversa)</span>
          </button>
        </div>
        <div class="helper" style="font-size:calc((var(--fs-md)+2px)*var(--font-scale)); max-width:460px; margin:12px auto 4px;">
          Clicando aqui você terá uma conversa com nosso agente online que irá facilitar o preenchimento do formulário.
        </div>
      </div>
    </div>

    <div class="card" id="importAnexo1Card">
      <div class="card-header">
        <div>
          <h2>Importar dados do Anexo I</h2>
          <div class="meta">Envie o Anexo I preenchido (PDF/DOC/DOCX) para preencher este relatório automaticamente.
          </div>
        </div>
        <span id="importBadge" class="badge">Opcional</span>
      </div>
      <div class="row" style="gap:10px; flex-wrap:wrap;">
        <input id="inputAnexo1" type="file"
          accept=".pdf,.doc,.docx,application/pdf,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
        <button type="button" class="btn" id="btnImportAnexo1">Ler arquivo</button>
        <div id="importProgress" class="progress-indicator" style="display:none;">
          <div class="spinner" aria-hidden="true"></div>
          <span data-progress-text>Interpretando Anexo I...</span>
        </div>
      </div>
      <div class="helper" id="importHelper">Usamos Docling para extrair nome, CPF, SIAPE, trechos e motivo da viagem.
      </div>
      <div class="helper" id="importWarnings" style="display:none;"></div>
    </div>
    

    <div class="card">
      <div class="card-header">
        <div>
          <h2 id="stepTitle">Passo 1</h2>
          <div class="meta">
            <span id="stepMeta">Preencha os dados para avançar.</span>
          </div>
        </div>
        <span class="pill">
          <span id="stepCount">1</span>/<span id="stepTotal">6</span>
        </span>
      </div>

      <div style="margin-top:10px;">
        <div class="progress-shell">
          <div id="progressBar" class="progress-bar"></div>
        </div>
      </div>
    </div>

    <form id="wizardForm" novalidate>

      <!-- STEP 1: Data relatório -->
      <section class="card step" data-step="1" data-title="Data do relatório"
        data-subtitle="Use a data de emissão do relatório.">
        <h2>1) Data do relatório</h2>
        <label>Data</label>
        <input id="dataRelDisplay" type="text" inputmode="numeric" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}"
          placeholder="dd/mm/aaaa" required style="width:100%;">
        <input name="data_relatorio" type="hidden">
      </section>

      <!-- STEP 2: Identificação -->
      <section class="card step" data-step="2" data-title="Identificação do proposto"
        data-subtitle="Nome, CPF, SIAPE e órgão.">
        <h2>2) Identificação do proposto</h2>

        <div class="grid2">
          <div>
            <label>Nome</label>
            <input name="proposto.nome" required placeholder="Ex.: Ana Pereira Souza">
          </div>
          <div>
            <label>CPF (somente números)</label>
            <input name="proposto.cpf" inputmode="numeric" pattern="[0-9]{11}" maxlength="11" required
              placeholder="Ex.: 12345678901">
          </div>
          <div>
            <label>SIAPE (somente números)</label>
            <input name="proposto.siape" inputmode="numeric" pattern="[0-9]{4,15}" required placeholder="Ex.: 123456">
          </div>
        </div>

        <label>Órgão de exercício</label>
        <select name="proposto.orgao.tipo" id="org_tipo" required>
          <option value="">Selecione...</option>
          <option value="cchsa">CCHSA</option>
          <option value="cavn">CAVN</option>
          <option value="projetos">Projetos</option>
          <option value="outros">Outros</option>
        </select>

        <div id="orgDetalheWrap" style="display:none;">
          <label>Detalhe (obrigatório para Projetos/Outros)</label>
          <input name="proposto.orgao.detalhe" id="org_det" placeholder="Ex.: Projeto ABC">
        </div>
      </section>

      <!-- STEP 3: Afastamento -->
      <section class="card step" data-step="3" data-title="Identificação do afastamento"
        data-subtitle="Ida e retorno (retorno não pode ser anterior à ida).">
        <h2>3) Identificação do afastamento</h2>

        <h3>Ida</h3>
        <div id="idaSegments2" class="segment-list"></div>
        <button type="button" class="btn btn-ghost btn-compact" id="addIdaSegment2">+ Adicionar trecho de ida</button>

        <h3>Retorno</h3>
        <div id="retornoSegments2" class="segment-list"></div>
        <button type="button" class="btn btn-ghost btn-compact" id="addRetornoSegment2">+ Adicionar trecho de retorno</button>
      </section>

      <!-- STEP 4: Atividades -->
      <section class="card step" data-step="4" data-title="Atividades desenvolvidas"
        data-subtitle="Descreva objetivamente o que foi realizado.">
        <h2>4) Atividades desenvolvidas</h2>
        <textarea name="atividades_desenvolvidas" minlength="20" required
          placeholder="Ex.: Relate de forma objetiva as atividades e resultados obtidos."></textarea>
      </section>

      <!-- STEP 5: Checagem prazo + justificativa -->
      <section class="card step" data-step="5" data-title="Prazo e justificativa"
        data-subtitle="Justificativa só é exigida se estiver fora do prazo (5 dias após retorno).">
        <h2>5) Prazo e justificativa</h2>

        <div class="row">
          <span id="badgePrazo" class="badge">Prazo: —</span>
        </div>

        <div class="helper">
          Regra: prestação de contas até 5 dias após o encerramento (retorno).
        </div>

        <hr class="sep" />

        <label class="checkbox">
          <input type="checkbox" name="flags.prestacao_contas_fora_prazo" value="true" id="flagPrazo" disabled>
          <div>
            <span>Prestação fora do prazo (calculado automaticamente)</span>
            <small>Se estiver fora do prazo, a justificativa será obrigatória.</small>
          </div>
        </label>

        <div id="wrapJustPrazo" style="display:none;">
          <label>Justificativa (fora do prazo)</label>
          <textarea name="justificativa_prestacao_contas_fora_prazo" id="justPrazo"></textarea>
        </div>

      </section>

      <!-- STEP 6: Confirmação -->
      <section class="card step" data-step="6" data-title="Confirmação"
        data-subtitle="Antes de revisar, confirme a realização da viagem.">
      <h2>6) Confirmação</h2>

      <label>A viagem foi realizada?</label>
      <select name="viagem_realizada" required>
        <option value="">Selecione...</option>
        <option value="sim">SIM</option>
        <option value="nao">NÃO</option>
      </select>

      <div class="card" id="alertNaoRealizada" style="margin-top:12px; background:rgba(239,68,68,0.08); border-color:rgba(239,68,68,0.35); display:none;">
        <div class="helper" style="font-size:calc((var(--fs-md)+2px)*var(--font-scale)); color:var(--text);">
          Enviar o relatório de viagem via SIPAC, informando que não ocorreu a viagem. Mantenha contato com o setor de contabilidade e finanças para instruções.<br><br>
          <strong>Obs:</strong> Ao escolher essa opção estará dando ciência.
        </div>
      </div>
    </section>

      <!-- STEP 7: Revisão e geração -->
      <section class="card step" data-step="7" data-title="Revisão e geração"
        data-subtitle="Confira o resumo antes de gerar.">
        <h2>7) Revisão e geração</h2>

        <div class="card" style="margin:0;">
          <div class="card-header">
            <div>
              <h2>Resumo</h2>
              <div class="meta">Confira antes de gerar.</div>
            </div>
            <span id="reviewBadge" class="badge">—</span>
          </div>
          <pre id="reviewText" class="review-text"></pre>
        </div>

        <hr class="sep" />

        <div class="row">
          <button type="button" class="btn btn-primary" id="btnDocx">Gerar DOCX</button>
          <button type="button" class="btn" id="btnPdf">Gerar PDF</button>
        </div>
        <div id="generateProgress" class="progress-indicator" style="display:none; margin-top:10px;">
          <div class="spinner" aria-hidden="true"></div>
          <span data-progress-text>Gerando documento...</span>
        </div>
      </section>

      <div class="card">
        <div id="errorsNav" class="errors" style="display:none; margin-top:0;"></div>
        <hr>
        <div class="row">
          <button type="button" class="btn btn-ghost" id="btnBack">Voltar</button>
          <button type="button" class="btn btn-primary" id="btnNext">Avançar</button>
        </div>
      </div>



    </form>
  </div>
  <div id="chatFullModal2" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.55); z-index:10000;">
    <div class="card" style="max-width:980px; margin:4vh auto; padding:0; overflow:hidden;">
      <div class="card-header" style="padding:14px 16px;">
        <div>
          <h2>Assistente de Relatório (ANEXO II)</h2>
          <div class="meta" id="chatFullMeta2">Vou fazer as perguntas e corrigir datas/consistências automaticamente.
          </div>
        </div>
        <button type="button" class="btn btn-ghost" id="chatFullClose2">Fechar</button>
      </div>

      <div id="chatFullTimeline2"
        style="height:56vh; overflow:auto; padding:14px 16px; background:rgba(255,255,255,0.02);"></div>

      <div style="padding:12px 16px; border-top:1px solid rgba(255,255,255,0.08);">
        <div id="chatFullQuick2" class="row" style="flex-wrap:wrap; gap:8px;"></div>

        <div class="helper" style="margin-top:8px;">
          Os dados ficam no navegador e só vão ao servidor quando você pedir para gerar o arquivo.
        </div>

        <div id="chatFullTextRow2" class="row" style="margin-top:10px; display:none;">
          <input id="chatFullText2" type="text" placeholder="Digite aqui..." style="flex:1;">
          <button type="button" class="btn btn-primary" id="chatFullSend2">Enviar</button>
        </div>

        <div id="chatFullDateRow2" class="row" style="margin-top:10px; display:none;">
          <input id="chatFullDate2" type="text" inputmode="numeric" pattern="[0-9]{2}/[0-9]{2}/[0-9]{4}"
            placeholder="dd/mm/aaaa">
          <button type="button" class="btn btn-primary" id="chatFullDateOk2">OK</button>
        </div>

        <div id="chatFullDTrow2" class="row" style="margin-top:10px; display:none;">
          <input id="chatFullDT2" type="datetime-local">
          <button type="button" class="btn btn-primary" id="chatFullDTok2">OK</button>
        </div>
      </div>
    </div>
  </div>

  <script src="/static/theme.js" defer></script>
  <script src="/static/anexo2.js" defer></script>
</body>

</html>
